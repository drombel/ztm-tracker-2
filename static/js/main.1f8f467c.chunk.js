(this["webpackJsonpztm-tracker-2"]=this["webpackJsonpztm-tracker-2"]||[]).push([[0],{124:function(e,t,n){},130:function(e,t,n){},133:function(e,t,n){},134:function(e,t,n){"use strict";n.r(t);var r=n(0),i=n.n(r),a=n(19),c=n.n(a),s=n(13),o=(n(124),n(198)),l=n(140),u=n(175),d=n(199),j=n(200),p=n(201),b=n(202),f=n(203),O=n(204),h=n(205),x=n(206),v=n(195),y=n(207),g=n(16),m=n(34),k=Object(m.b)({name:"marker",initialState:null,reducers:{setMarker:function(e,t){return t.payload},resetMarker:function(e){return null}}}),I=k.actions,C=I.setMarker,S=I.resetMarker,w=k.reducer,P=Object(m.b)({name:"buses",initialState:[],reducers:{setBuses:function(e,t){if(Array.isArray(t.payload)&&t.payload.length>0)return t.payload}}}),A=P.actions.setBuses,L=P.reducer,z=Object(m.b)({name:"routes",initialState:[],reducers:{setRoutes:function(e,t){if(Array.isArray(t.payload)&&t.payload.length>0)return t.payload}}}),R=z.actions.setRoutes,F=z.reducer,H={getRoutes:{type:"GET",url:"https://ckan.multimediagdansk.pl/dataset/c24aa637-3619-4dc2-a171-a23eec8f2172/resource/b15bb11c-7e06-4685-964e-3db7775f912f/download/trips.json"},getBuses:{type:"GET",url:"https://ckan2.multimediagdansk.pl/gpsPositions"}},D=n(85),_=(n(130),n(101)),B=n(2),M=function(e){var t=e.text,n=void 0===t?"":t,r=e.onClick,i=void 0===r?function(){return null}:r;return Object(B.jsx)(o.a,{color:"primary",onClick:i,style:{transform:"translate(-50%, -50%)"},children:Object(B.jsx)(l.a,{variant:"body1",children:n})})};var T=function(){var e=Object(D.a)(H.getBuses.url),t=Object(D.a)(H.getRoutes.url),n=Object(g.c)((function(e){return e.buses})),a=Object(g.c)((function(e){return e.routes})),c=Object(g.c)((function(e){return e.marker})),o=Object(g.c)((function(e){return e.settings})),l=Object(r.useRef)({buses:null,routes:null}),m=Object(g.b)();function k(){if(o.options.refresh){var t=[];e.get("?date=".concat((new Date).getTime())).then((function(e){var n;(t=Array.isArray(null===e||void 0===e?void 0:e.Vehicles)?null===e||void 0===e||null===(n=e.Vehicles)||void 0===n?void 0:n.filter((function(e){return e.GPSQuality>2})):[]).length>0&&m(A(t))}))}}var I=Object(r.useRef)(null);if(null===c||void 0===c?void 0:c.VehicleId){var w=n.find((function(e){return e.VehicleId===c.VehicleId})),P={};if(0!==(null===w||void 0===w?void 0:w.Delay)){var L=new Date(1e3*Math.abs(w.Delay)).toISOString().substr(11,8),z=(null===w||void 0===w?void 0:w.Delay)>0;P.delay={title:"Czas",value:Object(B.jsxs)("span",{style:{color:z?"#B00000":"#00B000"},children:[z?"Op\xf3\u017aniony":"Przed czasem"," ",L]})}}if(null===w||void 0===w?void 0:w.Route){var F=a.find((function(e){return e.tripId===parseInt(w.Route)&&e.routeId===parseInt(w.Line)}));F&&(P.route_stop={title:"Trasa",value:F.tripHeadsign})}(null===w||void 0===w?void 0:w.VehicleCode)&&(P.vehicle_code={title:"Kod pojazdu",value:w.VehicleCode}),(null===w||void 0===w?void 0:w.Speed)&&(P.speed={title:"Pr\u0119dko\u015b\u0107",value:"".concat(w.Speed," km/h")}),I.current=Object(B.jsxs)(i.a.Fragment,{children:[Object(B.jsx)(u.a,{sx:{textAlign:"center"},children:w.Line}),Object(B.jsx)(d.a,{children:Object(B.jsx)(j.a,{component:p.a,children:Object(B.jsx)(b.a,{"aria-label":"Dane autobusu",children:Object(B.jsx)(f.a,{children:Object.entries(P).map((function(e){var t=Object(s.a)(e,2),n=t[0],r=t[1];return Object(B.jsxs)(O.a,{children:[Object(B.jsx)(h.a,{component:"th",scope:"row",children:r.title}),Object(B.jsx)(h.a,{align:"right",children:r.value})]},n)}))})})})}),Object(B.jsx)(x.a,{children:Object(B.jsx)(v.a,{onClick:function(){return m(S())},children:"Zamknij"})})]})}Object(r.useEffect)((function(){0===(null===n||void 0===n?void 0:n.length)&&k(),clearInterval(l.current.buses),l.current.buses=setInterval((function(){k()}),5e3)}),[o]);var T=function(){!function(){var e=[];t.get("?date=".concat((new Date).getTime())).then((function(t){var n,r,i=(new Date).toISOString().split("T")[0];(e=t[i]&&(null===(n=t[i])||void 0===n?void 0:n.trips)&&Array.isArray(null===(r=t[i])||void 0===r?void 0:r.trips)?t[i].trips:[]).length>0&&m(R(e))}))}()},V=n;return(0!==o.filters.speed||!["","-"].includes(o.filters.delay)||o.filters.line.length>0||o.filters.route_stop.length>0)&&(V=V.filter((function(e){var t=!0;return t&=0!==o.filters.speed?e.Speed>=o.filters.speed:t,t&=["","-"].includes(o.filters.delay)?t:(e.Delay||0)<=-1*o.filters.delay,t&=o.filters.line.length>0?!!o.filters.line.find((function(t){return t.label==e.Line})):t,t&=o.filters.route_stop.length>0?!!o.filters.route_stop.find((function(t){return t.tripId===parseInt(e.Route)&&t.routeId===parseInt(e.Line)})):t,t}))),Object(B.jsxs)(i.a.Fragment,{children:[Object(B.jsx)("div",{style:{top:0,bottom:0,left:0,right:0,position:"absolute"},children:Object(B.jsx)(_.a,{bootstrapURLKeys:{key:"AIzaSyBtEh6FMFwJA-0X7NNb8yDlQ1M7x-PJ8iU"},defaultZoom:15,defaultCenter:{lat:54.3622393,lng:18.5750017},zoom:o.options.zoom,center:o.options.center,yesIWantToUseGoogleMapApiInternals:!0,onGoogleApiLoaded:function(){return T()},children:V.map((function(e){return e.Lat&&e.Lon?Object(B.jsx)(M,{data:e,lat:e.Lat,lng:e.Lon,text:e.Line,onClick:(t=e,function(){m(C(t))})},e.VehicleId):null;var t}))})}),Object(B.jsx)(y.a,{onClose:function(){m(S())},open:!!c&&!!I.current,children:I.current})]})},V=n(29),W={filters:{speed:0,delay:"",route_stop:[],line:[]},options:{refresh:!0,center:{lat:54.3622393,lng:18.5750017},zoom:15}},G=Object(m.b)({name:"settings",initialState:W,reducers:{setRefresh:function(e,t){e.options.refresh=!!t.payload},setFilters:function(e,t){var n,r={};t.payload.hasOwnProperty("speed")&&(r.speed=Math.max(Math.min(parseInt(t.payload.speed)||0,200),0)),t.payload.hasOwnProperty("delay")&&(r.delay=isNaN(parseInt(t.payload.delay))?"-"===t.payload.delay?"-":"":parseInt(t.payload.delay)||0),t.payload.hasOwnProperty("route_stop")&&(r.route_stop=Array.isArray(t.payload.route_stop)?t.payload.route_stop:W.filters.route_stop),t.payload.hasOwnProperty("line")&&(r.line=Array.isArray(t.payload.line)?null===(n=t.payload)||void 0===n?void 0:n.line:W.filters.line),e.filters=Object(V.a)(Object(V.a)({},e.filters),r)},resetFilters:function(e){e.filters=W.filters},setOptions:function(e,t){var n,r,i;e.options=Object(V.a)(Object(V.a)({},e.options),{},{center:(null===(n=t.payload)||void 0===n?void 0:n.center)?null===(r=t.payload)||void 0===r?void 0:r.center:e.center,zoom:(null===(i=t.payload)||void 0===i?void 0:i.center)?17:e.zoom})},resetOptions:function(e){e.filters=W.options}}}),E=G.actions,Z=E.setRefresh,U=E.setFilters,J=E.resetFilters,N=E.setOptions,K=E.resetOptions,Q=G.reducer,X=n(208),q=n(209),Y=n(210),$=n(193),ee=function(e){var t=e.popupState,n=void 0!==t&&t,r=e.setPopupState,i=void 0===r?function(){return null}:r,a=Object(g.c)((function(e){return e.settings})),c=Object(g.b)(),s=function(){return i(!1)};return Object(B.jsxs)(y.a,{onClose:s,open:!!n,children:[Object(B.jsx)(u.a,{sx:{textAlign:"center"},children:"Ustawienia"}),Object(B.jsx)(d.a,{children:Object(B.jsx)(X.a,{variant:"standard",fullWidth:!0,sx:{marginBottom:20},children:Object(B.jsx)(q.a,{children:Object(B.jsx)(Y.a,{control:Object(B.jsx)($.a,{checked:a.options.refresh,onClick:function(){c(Z(!a.options.refresh))}}),label:"Od\u015bwie\u017canie w tle"})})})}),Object(B.jsxs)(x.a,{children:[Object(B.jsx)(v.a,{onClick:function(){c(K())},children:"Resetuj"}),Object(B.jsx)(v.a,{onClick:s,children:"Zamknij"})]})]})},te=n(18),ne=n(180),re=n(189),ie=n(188),ae=function(e){var t=e.popupState,n=void 0!==t&&t,r=e.setPopupState,i=void 0===r?function(){return null}:r,a=Object(g.c)((function(e){return e.settings.filters})),c=Object(g.c)((function(e){return e.buses})),s=Object(g.c)((function(e){return e.routes})),o=Object(g.b)(),l=Object(te.a)(new Set(c.filter((function(e){return!!e.Line})).map((function(e){return e.Line})))).sort().map((function(e){return{label:e}})),j=s.filter((function(e,t,n){return!!e.tripHeadsign&&t===n.findIndex((function(t){return t.tripHeadsign===e.tripHeadsign}))})).sort((function(e,t){return e.tripHeadsign.localeCompare(t.tripHeadsign)})).map((function(e){return{label:e.tripHeadsign,id:e.id,key:e.id,routeId:e.routeId,tripId:e.tripId}})),p=function(){return i(!1)};return Object(B.jsxs)(y.a,{onClose:p,open:!!n,children:[Object(B.jsx)(u.a,{sx:{textAlign:"center"},children:"Filtry na\u0142o\u017cone na map\u0119"}),Object(B.jsx)(d.a,{children:Object(B.jsxs)(ne.a,{spacing:3,sx:{marginTop:10,minHeight:400},children:[Object(B.jsx)(X.a,{variant:"standard",fullWidth:!0,children:Object(B.jsx)(re.a,{label:"Pr\u0119dko\u015b\u0107",type:"number",onChange:function(e){return o(U({speed:e.target.value}))},value:a.speed,InputProps:{inputProps:{min:0,max:200}}})}),Object(B.jsx)(X.a,{variant:"standard",fullWidth:!0,children:Object(B.jsx)(re.a,{label:"Przy\u015bpieszenie sk\u0142adu w sekundach",type:"text",onChange:function(e){return o(U({delay:e.target.value}))},value:a.delay})}),Object(B.jsx)(X.a,{fullWidth:!0,children:Object(B.jsx)(ie.a,{disablePortal:!0,value:a.route_stop,multiple:!0,options:j,onChange:function(e,t){return o(U({route_stop:t}))},sx:{width:300},renderInput:function(e){return Object(B.jsx)(re.a,Object(V.a)(Object(V.a)({},e),{},{label:"Przystanek docelowy"}))}})}),Object(B.jsx)(X.a,{fullWidth:!0,children:Object(B.jsx)(ie.a,{disablePortal:!0,value:a.line,multiple:!0,options:l,onChange:function(e,t){return o(U({line:t}))},sx:{width:300},renderInput:function(e){return Object(B.jsx)(re.a,Object(V.a)(Object(V.a)({},e),{},{label:"Linia"}))}})})]})}),Object(B.jsxs)(x.a,{children:[Object(B.jsx)(v.a,{onClick:function(){return o(J())},children:"Resetuj"}),Object(B.jsx)(v.a,{onClick:p,children:"Zamknij"})]})]})},ce=n(194),se=n(181),oe=n(212),le=n(183),ue=function(e){var t=e.popupState,n=void 0!==t&&t,i=e.setPopupState,a=void 0===i?function(){return null}:i,c=Object(r.useState)(""),o=Object(s.a)(c,2),l=o[0],m=o[1],k=Object(g.c)((function(e){return e.buses})),I=Object(g.c)((function(e){return e.routes})),S=Object(r.useRef)([]),w=Object(g.b)(),P=function(){return a(!1)};S.current=k.map((function(e){var t=Object(V.a)({},e),n=I.find((function(t){return t.tripId===parseInt(e.Route)&&t.routeId===parseInt(e.Line)}));return t.tripHeadsign=(null===n||void 0===n?void 0:n.tripHeadsign)||"Brak docelowego przystanku",t}));var A=(l||"(.)*").trim().replace(" ",").*("),L=new RegExp(".*(".concat(A,")+.*"),"gi"),z=l?S.current.filter((function(e){return L.test(e.Line)||L.test(e.tripHeadsign)})):S.current;return Object(B.jsxs)(y.a,{onClose:P,open:!!n,children:[Object(B.jsx)(u.a,{sx:{textAlign:"center"},children:"Autobusy i tramwaje"}),Object(B.jsxs)(d.a,{sx:{height:"80vh",maxHeight:600},children:[Object(B.jsxs)(X.a,{variant:"standard",fullWidth:!0,sx:{marginBottom:20},children:[Object(B.jsx)(ce.a,{htmlFor:"component-simple",children:"Linia lub trasa"}),Object(B.jsx)(se.a,{value:l,onChange:function(e){return m(e.target.value)},sx:{width:500,maxWidth:"100%"},endAdornment:Object(B.jsx)(oe.a,{onClick:function(){return m("")},children:Object(B.jsx)(le.a,{})})})]}),Object(B.jsx)(j.a,{component:p.a,children:Object(B.jsx)(b.a,{"aria-label":"Lista autobus\xf3w",children:Object(B.jsx)(f.a,{children:z.map((function(e){return Object(B.jsxs)(O.a,{onClick:function(){return function(e){w(N({center:{lat:e.Lat,lng:e.Lon}})),w(C(e)),a(!1)}(e)},sx:{cursor:"pointer"},hover:!0,children:[Object(B.jsx)(h.a,{children:e.tripHeadsign}),Object(B.jsx)(h.a,{align:"right",children:e.Line})]},e.VehicleId)}))})})})]}),Object(B.jsx)(x.a,{children:Object(B.jsx)(v.a,{onClick:P,children:"Zamknij"})})]})},de=n(213),je=n(214),pe=n(215),be=n(197),fe=n(211),Oe=n(192),he=n(216),xe=n(217),ve=n(184),ye=n(185),ge=n(186),me=n(187);var ke=function(){var e=Object(r.useState)(!1),t=Object(s.a)(e,2),n=t[0],i=t[1],a=Object(r.useState)(!1),c=Object(s.a)(a,2),o=c[0],u=c[1],d=Object(r.useState)(!1),j=Object(s.a)(d,2),p=j[0],b=j[1],f=Object(r.useState)(!1),O=Object(s.a)(f,2),h=O[0],x=O[1],v=function(e){return function(t){("keydown"!==t.type||"Tab"!==t.key&&"Shift"!==t.key)&&i(e)}};return Object(B.jsxs)(de.a,{sx:{display:"flex",flexDirection:"column",minHeight:"100vh"},children:[Object(B.jsxs)("header",{children:[Object(B.jsx)(de.a,{sx:{flexGrow:1},children:Object(B.jsx)(je.a,{position:"sticky",children:Object(B.jsxs)(pe.a,{children:[Object(B.jsx)(oe.a,{size:"large",edge:"start",color:"inherit","aria-label":"menu",sx:{mr:2},onClick:v(!0),children:Object(B.jsx)(ve.a,{})}),Object(B.jsx)(l.a,{variant:"h6",component:"div",sx:{flexGrow:1},children:"ZTM tracker 2"})]})})}),Object(B.jsx)(be.a,{anchor:"left",open:n,onClose:v(!1),children:Object(B.jsx)(de.a,{sx:{width:250},role:"presentation",onClick:v(!1),onKeyDown:v(!1),children:Object(B.jsxs)(fe.a,{children:[Object(B.jsxs)(Oe.a,{button:!0,onClick:function(){return x(!0)},children:[Object(B.jsx)(he.a,{children:Object(B.jsx)(ye.a,{})}),Object(B.jsx)(xe.a,{primary:"Autobusy i tramwaje"})]}),Object(B.jsxs)(Oe.a,{button:!0,onClick:function(){return u(!0)},children:[Object(B.jsx)(he.a,{children:Object(B.jsx)(ge.a,{})}),Object(B.jsx)(xe.a,{primary:"Ustawienia"})]}),Object(B.jsxs)(Oe.a,{button:!0,onClick:function(){return b(!0)},children:[Object(B.jsx)(he.a,{children:Object(B.jsx)(me.a,{})}),Object(B.jsx)(xe.a,{primary:"Filtry"})]})]})})})]}),Object(B.jsx)(de.a,{sx:{flex:"1 0 0",display:"flex"},children:Object(B.jsx)(T,{})}),Object(B.jsx)(ee,{popupState:o,setPopupState:u}),Object(B.jsx)(ae,{popupState:p,setPopupState:b}),Object(B.jsx)(ue,{popupState:h,setPopupState:x})]})},Ie=(n(133),Object(m.a)({reducer:{marker:w,buses:L,routes:F,settings:Q}}));var Ce=function(){return Object(B.jsx)(g.a,{store:Ie,children:Object(B.jsx)(ke,{})})},Se=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,218)).then((function(t){var n=t.getCLS,r=t.getFID,i=t.getFCP,a=t.getLCP,c=t.getTTFB;n(e),r(e),i(e),a(e),c(e)}))};c.a.render(Object(B.jsx)(i.a.StrictMode,{children:Object(B.jsx)(Ce,{})}),document.getElementById("root")),Se()}},[[134,1,2]]]);
//# sourceMappingURL=main.1f8f467c.chunk.js.map