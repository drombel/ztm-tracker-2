(this["webpackJsonpztm-tracker-2"]=this["webpackJsonpztm-tracker-2"]||[]).push([[0],{124:function(e,t,n){},130:function(e,t,n){},133:function(e,t,n){},134:function(e,t,n){"use strict";n.r(t);var r=n(0),i=n.n(r),a=n(19),c=n.n(a),o=n(13),s=(n(124),n(198)),l=n(140),u=n(175),d=n(199),j=n(200),b=n(201),p=n(202),O=n(203),f=n(204),h=n(205),x=n(206),v=n(195),y=n(207),g=n(16),m=n(34),k=Object(m.b)({name:"marker",initialState:null,reducers:{setMarker:function(e,t){return t.payload},resetMarker:function(e){return null}}}),I=k.actions,C=I.setMarker,w=I.resetMarker,S=k.reducer,P=Object(m.b)({name:"buses",initialState:[],reducers:{setBuses:function(e,t){if(Array.isArray(t.payload)&&t.payload.length>0)return t.payload}}}),A=P.actions.setBuses,L=P.reducer,z=Object(m.b)({name:"routes",initialState:[],reducers:{setRoutes:function(e,t){if(Array.isArray(t.payload)&&t.payload.length>0)return t.payload}}}),R=z.actions.setRoutes,F=z.reducer,H={getRoutes:{type:"GET",url:"https://ckan.multimediagdansk.pl/dataset/c24aa637-3619-4dc2-a171-a23eec8f2172/resource/b15bb11c-7e06-4685-964e-3db7775f912f/download/trips.json"},getBuses:{type:"GET",url:"https://ckan2.multimediagdansk.pl/gpsPositions"}},_=n(85),B=(n(130),n(101)),D=n(2),M=function(e){var t=e.text,n=void 0===t?"":t,r=e.onClick,i=void 0===r?function(){return null}:r;return Object(D.jsx)(s.a,{color:"primary",onClick:i,style:{transform:"translate(-50%, -50%)"},children:Object(D.jsx)(l.a,{variant:"body1",children:n})})};var T=function(){var e=Object(_.a)(H.getBuses.url),t=Object(_.a)(H.getRoutes.url),n=Object(g.c)((function(e){return e.buses})),a=Object(g.c)((function(e){return e.routes})),c=Object(g.c)((function(e){return e.marker})),s=Object(g.c)((function(e){return e.settings})),l=Object(r.useRef)({buses:null,routes:null}),m=Object(g.b)();function k(){if(s.options.refresh){var t=[];e.get("?date=".concat((new Date).getTime())).then((function(e){var n;(t=Array.isArray(null===e||void 0===e?void 0:e.Vehicles)?null===e||void 0===e||null===(n=e.Vehicles)||void 0===n?void 0:n.filter((function(e){return e.GPSQuality>2})):[]).length>0&&m(A(t))}))}}var I=Object(r.useRef)(null);if(null===c||void 0===c?void 0:c.VehicleId){var S=n.find((function(e){return e.VehicleId===c.VehicleId})),P={};if(0!==(null===S||void 0===S?void 0:S.Delay)){var L=new Date(1e3*Math.abs(S.Delay)).toISOString().substr(11,8),z=(null===S||void 0===S?void 0:S.Delay)>0;P.delay={title:"Czas",value:Object(D.jsxs)("span",{style:{color:z?"#B00000":"#00B000"},children:[z?"Op\xf3\u017aniony":"Przed czasem"," ",L]})}}if(null===S||void 0===S?void 0:S.Route){var F=a.find((function(e){return e.tripId===parseInt(S.Route)&&e.routeId===parseInt(S.Line)}));F&&(P.route_stop={title:"Trasa",value:F.tripHeadsign})}(null===S||void 0===S?void 0:S.VehicleCode)&&(P.vehicle_code={title:"Kod pojazdu",value:S.VehicleCode}),(null===S||void 0===S?void 0:S.Speed)&&(P.speed={title:"Pr\u0119dko\u015b\u0107",value:"".concat(S.Speed," km/h")}),I.current=Object(D.jsxs)(i.a.Fragment,{children:[Object(D.jsx)(u.a,{sx:{textAlign:"center"},children:S.Line}),Object(D.jsx)(d.a,{children:Object(D.jsx)(j.a,{component:b.a,children:Object(D.jsx)(p.a,{"aria-label":"Dane autobusu",children:Object(D.jsx)(O.a,{children:Object.entries(P).map((function(e){var t=Object(o.a)(e,2),n=t[0],r=t[1];return Object(D.jsxs)(f.a,{children:[Object(D.jsx)(h.a,{component:"th",scope:"row",children:r.title}),Object(D.jsx)(h.a,{align:"right",children:r.value})]},n)}))})})})}),Object(D.jsx)(x.a,{children:Object(D.jsx)(v.a,{onClick:function(){return m(w())},children:"Zamknij"})})]})}Object(r.useEffect)((function(){0===(null===n||void 0===n?void 0:n.length)&&k(),clearInterval(l.current.buses),l.current.buses=setInterval((function(){k()}),5e3)}),[s]);var T=function(){!function(){var e=[];t.get("?date=".concat((new Date).getTime())).then((function(t){var n,r,i=(new Date).toISOString().split("T")[0];(e=t[i]&&(null===(n=t[i])||void 0===n?void 0:n.trips)&&Array.isArray(null===(r=t[i])||void 0===r?void 0:r.trips)?t[i].trips:[]).length>0&&m(R(e))}))}()},V=n;return(0!==s.filters.speed||!["","-"].includes(s.filters.delay)||s.filters.line.length>0||s.filters.route_stop.length>0)&&(V=V.filter((function(e){var t=!0;return t&=s.filters.route_stop.length>0?!!s.filters.route_stop.find((function(t){return t.tripId===parseInt(e.Route)&&t.routeId===parseInt(e.Line)})):t,t}))),Object(D.jsxs)(i.a.Fragment,{children:[Object(D.jsx)("div",{style:{top:0,bottom:0,left:0,right:0,position:"absolute"},children:Object(D.jsx)(B.a,{bootstrapURLKeys:{key:"AIzaSyBtEh6FMFwJA-0X7NNb8yDlQ1M7x-PJ8iU"},defaultZoom:15,defaultCenter:{lat:54.3622393,lng:18.5750017},zoom:s.options.zoom,center:s.options.center,yesIWantToUseGoogleMapApiInternals:!0,onGoogleApiLoaded:function(){return T()},children:V.map((function(e){return e.Lat&&e.Lon?Object(D.jsx)(M,{data:e,lat:e.Lat,lng:e.Lon,text:e.Line,onClick:(t=e,function(){m(C(t))})},e.VehicleId):null;var t}))})}),Object(D.jsx)(y.a,{onClose:function(){m(w())},open:!!c&&!!I.current,children:I.current})]})},V=n(29),W={filters:{speed:0,delay:"",route_stop:[],line:[]},options:{refresh:!0,center:{lat:54.3622393,lng:18.5750017},zoom:15}},G=Object(m.b)({name:"settings",initialState:W,reducers:{setRefresh:function(e,t){e.options.refresh=!!t.payload},setFilters:function(e,t){var n,r={};t.payload.hasOwnProperty("speed")&&(r.speed=Math.max(Math.min(parseInt(t.payload.speed)||0,200),0)),t.payload.hasOwnProperty("delay")&&(r.delay=isNaN(parseInt(t.payload.delay))?"-"===t.payload.delay?"-":"":parseInt(t.payload.delay)||0),t.payload.hasOwnProperty("route_stop")&&(r.route_stop=Array.isArray(t.payload.route_stop)?t.payload.route_stop:W.filters.route_stop),t.payload.hasOwnProperty("line")&&(r.line=Array.isArray(t.payload.line)?null===(n=t.payload)||void 0===n?void 0:n.line:W.filters.line),e.filters=Object(V.a)(Object(V.a)({},e.filters),r)},resetFilters:function(e){e.filters=W.filters},setOptions:function(e,t){var n,r,i;e.options=Object(V.a)(Object(V.a)({},e.options),{},{center:(null===(n=t.payload)||void 0===n?void 0:n.center)?null===(r=t.payload)||void 0===r?void 0:r.center:e.center,zoom:(null===(i=t.payload)||void 0===i?void 0:i.center)?17:e.zoom})},resetOptions:function(e){e.filters=W.options}}}),E=G.actions,Z=E.setRefresh,U=E.setFilters,J=E.resetFilters,N=E.setOptions,K=E.resetOptions,Q=G.reducer,X=n(208),q=n(209),Y=n(210),$=n(193),ee=function(e){var t=e.popupState,n=void 0!==t&&t,r=e.setPopupState,i=void 0===r?function(){return null}:r,a=Object(g.c)((function(e){return e.settings})),c=Object(g.b)(),o=function(){return i(!1)};return Object(D.jsxs)(y.a,{onClose:o,open:!!n,children:[Object(D.jsx)(u.a,{sx:{textAlign:"center"},children:"Ustawienia"}),Object(D.jsx)(d.a,{children:Object(D.jsx)(X.a,{variant:"standard",fullWidth:!0,sx:{marginBottom:20},children:Object(D.jsx)(q.a,{children:Object(D.jsx)(Y.a,{control:Object(D.jsx)($.a,{checked:a.options.refresh,onClick:function(){c(Z(!a.options.refresh))}}),label:"Od\u015bwie\u017canie w tle"})})})}),Object(D.jsxs)(x.a,{children:[Object(D.jsx)(v.a,{onClick:function(){c(K())},children:"Resetuj"}),Object(D.jsx)(v.a,{onClick:o,children:"Zamknij"})]})]})},te=n(18),ne=n(180),re=n(189),ie=n(188),ae=function(e){var t=e.popupState,n=void 0!==t&&t,r=e.setPopupState,i=void 0===r?function(){return null}:r,a=Object(g.c)((function(e){return e.settings.filters})),c=Object(g.c)((function(e){return e.buses})),o=Object(g.c)((function(e){return e.routes})),s=Object(g.b)(),l=Object(te.a)(new Set(c.filter((function(e){return!!e.Line})).map((function(e){return e.Line})))).sort().map((function(e){return{label:e}})),j=o.filter((function(e,t,n){return!!e.tripHeadsign&&t===n.findIndex((function(t){return t.tripHeadsign===e.tripHeadsign}))})).sort((function(e,t){return e.tripHeadsign.localeCompare(t.tripHeadsign)})).map((function(e){return{label:e.tripHeadsign,id:e.id,key:e.id,routeId:e.routeId,tripId:e.tripId}})),b=function(){return i(!1)};return Object(D.jsxs)(y.a,{onClose:b,open:!!n,children:[Object(D.jsx)(u.a,{sx:{textAlign:"center"},children:"Filtry na\u0142o\u017cone na map\u0119"}),Object(D.jsx)(d.a,{children:Object(D.jsxs)(ne.a,{spacing:3,sx:{marginTop:10,minHeight:400},children:[Object(D.jsx)(X.a,{variant:"standard",fullWidth:!0,children:Object(D.jsx)(re.a,{label:"Pr\u0119dko\u015b\u0107",type:"number",onChange:function(e){return s(U({speed:e.target.value}))},value:a.speed,InputProps:{inputProps:{min:0,max:200}}})}),Object(D.jsx)(X.a,{variant:"standard",fullWidth:!0,children:Object(D.jsx)(re.a,{label:"Przy\u015bpieszenie sk\u0142adu w sekundach",type:"text",onChange:function(e){return s(U({delay:e.target.value}))},value:a.delay})}),Object(D.jsx)(X.a,{fullWidth:!0,children:Object(D.jsx)(ie.a,{disablePortal:!0,value:a.route_stop,multiple:!0,options:j,onChange:function(e,t){return s(U({route_stop:t}))},sx:{width:300},renderInput:function(e){return Object(D.jsx)(re.a,Object(V.a)(Object(V.a)({},e),{},{label:"Przystanek docelowy"}))}})}),Object(D.jsx)(X.a,{fullWidth:!0,children:Object(D.jsx)(ie.a,{disablePortal:!0,value:a.line,multiple:!0,options:l,onChange:function(e,t){return s(U({line:t}))},sx:{width:300},renderInput:function(e){return Object(D.jsx)(re.a,Object(V.a)(Object(V.a)({},e),{},{label:"Linia"}))}})})]})}),Object(D.jsxs)(x.a,{children:[Object(D.jsx)(v.a,{onClick:function(){return s(J())},children:"Resetuj"}),Object(D.jsx)(v.a,{onClick:b,children:"Zamknij"})]})]})},ce=n(194),oe=n(181),se=n(212),le=n(183),ue=function(e){var t=e.popupState,n=void 0!==t&&t,i=e.setPopupState,a=void 0===i?function(){return null}:i,c=Object(r.useState)(""),s=Object(o.a)(c,2),l=s[0],m=s[1],k=Object(g.c)((function(e){return e.buses})),I=Object(g.c)((function(e){return e.routes})),w=Object(r.useRef)([]),S=Object(g.b)(),P=function(){return a(!1)};w.current=k.map((function(e){var t=Object(V.a)({},e),n=I.find((function(t){return t.tripId===parseInt(e.Route)&&t.routeId===parseInt(e.Line)}));return t.tripHeadsign=(null===n||void 0===n?void 0:n.tripHeadsign)||"Brak docelowego przystanku",t}));var A=(l||"(.)*").trim().replace(" ",").*("),L=new RegExp(".*(".concat(A,")+.*"),"gi"),z=l?w.current.filter((function(e){return L.test(e.Line)||L.test(e.tripHeadsign)})):w.current;return Object(D.jsxs)(y.a,{onClose:P,open:!!n,children:[Object(D.jsx)(u.a,{sx:{textAlign:"center"},children:"Autobusy i tramwaje"}),Object(D.jsxs)(d.a,{sx:{height:"80vh",maxHeight:600},children:[Object(D.jsxs)(X.a,{variant:"standard",fullWidth:!0,sx:{marginBottom:20},children:[Object(D.jsx)(ce.a,{htmlFor:"component-simple",children:"Linia lub trasa"}),Object(D.jsx)(oe.a,{value:l,onChange:function(e){return m(e.target.value)},sx:{width:500,maxWidth:"100%"},endAdornment:Object(D.jsx)(se.a,{onClick:function(){return m("")},children:Object(D.jsx)(le.a,{})})})]}),Object(D.jsx)(j.a,{component:b.a,children:Object(D.jsx)(p.a,{"aria-label":"Lista autobus\xf3w",children:Object(D.jsx)(O.a,{children:z.map((function(e){return Object(D.jsxs)(f.a,{onClick:function(){return function(e){S(N({center:{lat:e.Lat,lng:e.Lon}})),S(C(e)),a(!1)}(e)},sx:{cursor:"pointer"},hover:!0,children:[Object(D.jsx)(h.a,{children:e.tripHeadsign}),Object(D.jsx)(h.a,{align:"right",children:e.Line})]},e.VehicleId)}))})})})]}),Object(D.jsx)(x.a,{children:Object(D.jsx)(v.a,{onClick:P,children:"Zamknij"})})]})},de=n(213),je=n(214),be=n(215),pe=n(197),Oe=n(211),fe=n(192),he=n(216),xe=n(217),ve=n(184),ye=n(185),ge=n(186),me=n(187);var ke=function(){var e=Object(r.useState)(!1),t=Object(o.a)(e,2),n=t[0],i=t[1],a=Object(r.useState)(!1),c=Object(o.a)(a,2),s=c[0],u=c[1],d=Object(r.useState)(!1),j=Object(o.a)(d,2),b=j[0],p=j[1],O=Object(r.useState)(!1),f=Object(o.a)(O,2),h=f[0],x=f[1],v=function(e){return function(t){("keydown"!==t.type||"Tab"!==t.key&&"Shift"!==t.key)&&i(e)}};return Object(D.jsxs)(de.a,{sx:{display:"flex",flexDirection:"column",minHeight:"100vh"},children:[Object(D.jsxs)("header",{children:[Object(D.jsx)(de.a,{sx:{flexGrow:1},children:Object(D.jsx)(je.a,{position:"sticky",children:Object(D.jsxs)(be.a,{children:[Object(D.jsx)(se.a,{size:"large",edge:"start",color:"inherit","aria-label":"menu",sx:{mr:2},onClick:v(!0),children:Object(D.jsx)(ve.a,{})}),Object(D.jsx)(l.a,{variant:"h6",component:"div",sx:{flexGrow:1},children:"ZTM tracker 2"})]})})}),Object(D.jsx)(pe.a,{anchor:"left",open:n,onClose:v(!1),children:Object(D.jsx)(de.a,{sx:{width:250},role:"presentation",onClick:v(!1),onKeyDown:v(!1),children:Object(D.jsxs)(Oe.a,{children:[Object(D.jsxs)(fe.a,{button:!0,onClick:function(){return x(!0)},children:[Object(D.jsx)(he.a,{children:Object(D.jsx)(ye.a,{})}),Object(D.jsx)(xe.a,{primary:"Autobusy i tramwaje"})]}),Object(D.jsxs)(fe.a,{button:!0,onClick:function(){return u(!0)},children:[Object(D.jsx)(he.a,{children:Object(D.jsx)(ge.a,{})}),Object(D.jsx)(xe.a,{primary:"Ustawienia"})]}),Object(D.jsxs)(fe.a,{button:!0,onClick:function(){return p(!0)},children:[Object(D.jsx)(he.a,{children:Object(D.jsx)(me.a,{})}),Object(D.jsx)(xe.a,{primary:"Filtry"})]})]})})})]}),Object(D.jsx)(de.a,{sx:{flex:"1 0 0",display:"flex"},children:Object(D.jsx)(T,{})}),Object(D.jsx)(ee,{popupState:s,setPopupState:u}),Object(D.jsx)(ae,{popupState:b,setPopupState:p}),Object(D.jsx)(ue,{popupState:h,setPopupState:x})]})},Ie=(n(133),Object(m.a)({reducer:{marker:S,buses:L,routes:F,settings:Q}}));var Ce=function(){return Object(D.jsx)(g.a,{store:Ie,children:Object(D.jsx)(ke,{})})},we=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,218)).then((function(t){var n=t.getCLS,r=t.getFID,i=t.getFCP,a=t.getLCP,c=t.getTTFB;n(e),r(e),i(e),a(e),c(e)}))};c.a.render(Object(D.jsx)(i.a.StrictMode,{children:Object(D.jsx)(Ce,{})}),document.getElementById("root")),we()}},[[134,1,2]]]);
//# sourceMappingURL=main.837c9c0e.chunk.js.map